#!/bin/bash


function build_shared()
{


   BASEDIR=$HOME/build_shared
   PREFIX=$BASEDIR/shared

   export MACOSX_DEPLOYMENT_TARGET=10.9
   #export LD_RUNPATH_SEARCH_PATHS=@executable_path
   #export INSTALL_PATH=@executable_path
   export PKG_CONFIG_PATH=$PREFIX/lib/pkgconfig/

   cd $BASEDIR

   echo "Fetching FFmpeg..."
   git clone https://git.ffmpeg.org/ffmpeg.git ffmpeg
   cd ffmpeg
   ./configure --extra-cflags="-I$PREFIX/include" --extra-ldflags="-L$PREFIX/lib" --bindir="$PREFIX/bin" --prefix=$PREFIX --libdir=@executable_path --enable-gpl --enable-nonfree --enable-libfdk-aac --enable-libfreetype --enable-libmp3lame --enable-libx264 --enable-pic --enable-shared --enable-static
   make -j 8
   make install

   unlink $PREFIX/lib/libavcodec.dylib
   mv $PREFIX/lib/libavcodec.57.dylib $PREFIX/lib/libavcodec.dylib
   install_name_tool -id @executable_path/libavcodec.dylib $PREFIX/lib/libavcodec.dylib

   unlink $PREFIX/lib/libavformat.dylib
   mv $PREFIX/lib/libavformat.57.dylib $PREFIX/lib/libavformat.dylib
   install_name_tool -id @executable_path/libavformat.dylib $PREFIX/lib/libavformat.dylib

   unlink $PREFIX/lib/libavutil.dylib
   mv $PREFIX/lib/libavutil.57.dylib $PREFIX/lib/libavutil.dylib
   install_name_tool -id @executable_path/libavutil.dylib $PREFIX/lib/libavutil.dylib

   unlink $PREFIX/lib/libavutil.dylib
   mv $PREFIX/lib/libavutil.57.dylib $PREFIX/lib/libavutil.dylib
   install_name_tool -id @executable_path/libavutil.dylib $PREFIX/lib/libavutil.dylib

   unlink $PREFIX/lib/libswresample.dylib
   mv $PREFIX/lib/libswresample.7.dylib $PREFIX/lib/libswresample.dylib
   install_name_tool -id @executable_path/libswresample.dylib $PREFIX/lib/libswresample.dylib



}


build_shared



