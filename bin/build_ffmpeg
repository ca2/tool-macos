#!/bin/bash


function build_static()
{

   BASEDIR=$HOME/build_static
   PREFIX=$BASEDIR/static

   mkdir -p $PREFIX

   export MACOSX_DEPLOYMENT_TARGET=10.9

   cd $BASEDIR

   echo "Fetching x264..."
   git clone https://code.videolan.org/videolan/x264.git x264
   cd x264
   echo "Building x264..."
   ./configure --prefix=$PREFIX --enable-static
   make
   make install

   cd $BASEDIR

   echo "Fetching FDK AAC..."
   git clone https://github.com/mstorsjo/fdk-aac.git fdk-aac
   cd fdk-aac
   echo "Building FDK AAC..."
   ./autogen.sh
   ./configure --prefix=$PREFIX --enable-static
   make 
   make install

   cd $BASEDIR

   echo "Fetching Lame..."
   git clone https://github.com/zlargon/lame.git lame
   cd lame
   echo "Building Lame..."
   ./configure --prefix=$PREFIX --enable-static
   make 
   make install

   cd $BASEDIR

   echo "Fetching freetype..."
   git clone https://github.com/freetype/freetype.git freetype
   cd freetype
   echo "Building freetype..."
   ./configure --prefix=$PREFIX --enable-static
   make 
   make install

   cd $BASEDIR

   echo "Fetching FFmpeg..."
   git clone https://git.ffmpeg.org/ffmpeg.git ffmpeg
   cd ffmpeg
   ./configure --prefix=$PREFIX --enable-gpl --enable-nonfree --enable-libfdk-aac --enable-libfreetype --enable-libmp3lame --enable-libx264 --enable-static

   mkdir -p $HOME/solution/basis/archive/storage-macos/library/x86_64/Debug
   mkdir -p $HOME/solution/basis/archive/storage-macos/library/x86_64/Release
   cp $PREFIX/lib/* $HOME/solution/basis/archive/storage-macos/library/x86_64/Debug
   cp $PREFIX/lib/* $HOME/solution/basis/archive/storage-macos/library/x86_64/Release

}


function build_shared()
{

   BASEDIR=$HOME/build_shared
   PREFIX=$BASEDIR/shared

   mkdir -p $BASEDIR/@executable_path

   export MACOSX_DEPLOYMENT_TARGET=10.9
   export LD_RUNPATH_SEARCH_PATHS=@executable_path
   export INSTALL_PATH=@executable_path

   cd $BASEDIR

   echo "Fetching x264..."
   git clone https://code.videolan.org/videolan/x264.git x264
   cd x264
   echo "Building x264..."
   ./configure --prefix=$PREFIX --libdir=@executable_path --enable-pic --enable-shared 
   make
   make install
   cp @executable_path/* ../@executable_path

   cd $BASEDIR

   echo "Fetching FDK AAC..."
   git clone https://github.com/mstorsjo/fdk-aac.git fdk-aac
   cd fdk-aac
   echo "Building FDK AAC..."
   ./configure --prefix=$PREFIX --libdir=@executable_path --enable-pic --enable-shared 
   make 
   make install
   cp @executable_path/* ../@executable_path

   cd $BASEDIR

   echo "Fetching Lame..."
   git clone https://github.com/zlargon/lame.git lame
   cd lame
   echo "Building Lame..."
   ./configure --prefix=$PREFIX --libdir=@executable_path --enable-pic --enable-shared 
   make 
   make install
   cp @executable_path/* ../@executable_path

   cd $BASEDIR

   echo "Fetching freetype..."
   git clone https://github.com/freetype/freetype.git freetype
   cd freetype
   echo "Building freetype..."
   ./configure --prefix=$PREFIX --libdir=@executable_path --enable-pic --enable-shared 
   make 
   make install
   cp @executable_path/* ../@executable_path

   cd $BASEDIR

   echo "Fetching FFmpeg..."
   git clone https://git.ffmpeg.org/ffmpeg.git ffmpeg
   cd ffmpeg
   ./configure  --prefix=$PREFIX --libdir=@executable_path --enable-gpl --enable-nonfree --enable-libfdk-aac --enable-libfreetype --enable-libmp3lame --enable-libx264 --enable-pic --enable-shared

   cd $BASEDIR

   mkdir -p $HOME/solution/basis/archive/storage-macos/library/x86_64/Debug
   mkdir -p $HOME/solution/basis/archive/storage-macos/library/x86_64/Release
   cp @executable_path/* $HOME/solution/basis/archive/storage-macos/library/x86_64/Debug
   cp @executable_path/* $HOME/solution/basis/archive/storage-macos/library/x86_64/Release

}


build_static

build_shared



